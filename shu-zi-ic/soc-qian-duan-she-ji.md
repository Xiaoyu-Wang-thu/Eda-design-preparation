# SoC设计

## 一、SoC简介

soc全称system on chip，需要在一个芯片集成模拟ip，存储器和数字ip功能，进而实现不依赖于外部器件，就可以完成从上电，到复位，从复位到代码加载并执行。这需要从系统层面规划上电时序，复位时序，代码加载时序，存储空间分配以及寄存器空间分配，更复杂一些的还涉及到低功耗设计，引脚功能复用等。soc设计一个典型的产品就是mcu。

<img src="../.gitbook/assets/image (1).png" alt="" data-size="original">![](../.gitbook/assets/image.png)

## 二、SoC设计内容



### 总线设计

**总线结构及互连设计**直接影响芯片总体性能发挥，选用成熟的**总线架构**有利于SoC整体性能提升。对于系列化或综合性能要求高的SoC设计，就需要深入进行系统架构研究和优化，将**总线频率和带宽提升**到更高水平。目前SoC总线主要分成IP授权和开源两大类，主流商用总线选用**ARM的AMBA系列、片上网络NoC总线、wishbone总线**等。构建深度优化的总线架构，有利于SoC系统的性能提升，解决总线瓶颈让SoC芯片更具竞争力。

### IP核复用技术

IP核指可以重复使用的、经过验证的拥有知识产权的电路模块，一般分为**硬核、软核和固核**三种。IP**硬核**是指经过预先布局、并对尺寸和功耗进行优化的、不能由设计者修改的**电路模块**，硬核提供的为掩膜；IP软核是指由VHDL/Verilog等硬件描述语言写出来的电路代码，与具体的工艺无关，可**基于软核进行电路修改和工艺调整**；**固核**是指由RTL描述和可综合网表文件描述的电路模块，可基于网表完成后续工艺调整和修改。

IP核复用是指利用成熟的IP核进行芯片设计，采用已有的功能模块，可大大减轻设计者的工作量并减少设计风险，同时缩短设计周期，快速迭代芯片产品，提供系统性能。IP核复用必须有**很好的兼容性和可移植性**，必须提供标准的接口以达到复用目的，同时提供良好的开发文档和参考手册帮助购买IP核的设计人员能够快速上手使用。

### 软硬件协同设计

由于市场和设计风险的压力，SoC软硬件协同设计尤为重要。软硬件协同的关键在于让**软件提前介入芯片前期设计和方案论证过程**，保证硬件设计和软件实现高效同步，能有效减少硬件设计过程中的设计风险，缩短嵌入式软件的开发调试时间。同时在协同验证环境中，能够及时发现软硬件中存在的问题，避免在最后集成测试阶段重新进行软硬件设计调整。

### SoC设计验证技术

* 包含三个阶段：IP核验证、IP核与总线接口兼容性验证和系统级验证。
* 内容：包括兼容性测试、边角测试、随机测试、pattern测试、回归regression测试和断言测试等。由于芯片越来越复杂，软件仿真开销大，硬件仿真验证成为一种重要的验证手段。验证工作约占整个设计工作的70%，如何提高**验证覆盖率和验证效率**是SoC设计验证部分最重要的研究内容。

### 芯片综合/时序分析技术

由于SoC系统复杂度和规模越来越庞大，多时钟、多电压等新挑战不断出现，对SoC的综合性研究提出了更高的要求。尤其是对时序分析，关键路径的特殊约束分析，要求研究人员具有深厚的SoC系统设计背景知识。与此同时，静态时序分析（STA）、代码规则检查也日趋复杂，后端仿真效率低下等问题，对总体设计人员和SoC系统提出了更苛刻的要求。

## 三、SoC设计流程

**Soc设计流程**：SoC主要包括了硬件和软件两个部分。

### 1. 功能设计阶段

* 性能指标：设计目标产品的应用场合，**设定一些诸如功能、性能、接口规格、温度、功耗等指标**，作为后续电路设计的输入依据。
* 自顶向下的设计(总体设计->各个维度设计->子模块设计)：首先完成芯片总体结构、规格参数、模块划分、使用技术以及各个功能模块的详细定义。**总体设计**规划完成后，再制定**各个维度**的设计方案，比如：芯片设计方案、软件功能方案、封装方案、工艺确定等。芯片设计方案按照自顶向下方式，逐级分解设计模块，形成各个模块的设计方案。

### 2. 设计描述和行为级验证

1. 将SoC划分成若干功能模块，并决定这些功能模块是否需要使用IP核。该过程直接影响SoC的内部架构及各模块的顶层信号互连，并在后续设计过程中起到**决定性**作用，因此需要非常仔细谨慎地选择产品和IP核。
2. 对于不需要使用IP核的模块，可使用VHDL/Verilog等硬件描述语言完成硬件电路各模块的**设计工作**。同时定义各个模块的功能点，按照功能点进行功能仿真验证和行为级验证。**行为级仿真**验证不考虑时序延时，因此无法覆盖时序相关问题，只能保证设计的功能正确性。时序延时的正确性需要通过其他手段实现，比如STA静态时序分析、CDC/RDC代码规则检查等。

### 3.逻辑综合

* 确定设计描述后，可使用逻辑综合工具对代码进行综合。综合过程需要**选择适当的逻辑器件库和SDC时序约束文件**，作为合成逻辑电路的综合参数。
* 逻辑综合时，需要确定SDC约束文件的正确性，如果是IP核，IP核厂商会提供原版SDC约束文件，但并不适合芯片全局的SDC约束。因此，无论是使用的IP核，还是编写的verilog代码，均需要整理**编写SDC约束文件**。同时，SDC约束文件也是CDC/RDC代码规则检查的输入文件之一。

### 4. 布局布线与后仿真

* 布局是指将设计好的功能模块**合理地安排在芯片上**，规划好它们的位置。**布线**是指完成各个模块之间的互连连线。各个模块之间的连线相对较长，因此，产生的延迟会严重影响SoC性能，另外后端在实际布局布线过程中，可能会发现时序不满足，关键路径过长等问题，这些问题均需要通过定位分析的方式反馈给前端或者综合工具，进行布局布线调整。
* 后仿真：仿真带有SDF延时参数的仿真，后仿真用于测试芯片的时序是否满足要求，功能性仿真在前仿时已经验证通过，因此后仿真更关注于仿真过程中的setup、hold time情况。对于后仿真出现的问题，需要定位问题点，判断是否需要后端修复、ECO修复或RTL重综合。

\
